<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Narmada River Route - Interactive Guide</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" rel="stylesheet">
    <style>
        /* Theme Variables */
        :root {
            --primary: #3b82f6;
            --primary-light: #60a5fa;
            --bg-light: #f8fafc;
            --text-light: #1e293b;
            --card-light: #ffffff;
            --border-light: #e2e8f0;
            --bg-dark: #0f172a;
            --text-dark: #e2e8f0;
            --card-dark: #1e293b;
            --border-dark: #334155;
        }

        [data-theme="dark"] {
            --bg: var(--bg-dark);
            --text: var(--text-dark);
            --card: var(--card-dark);
            --border: var(--border-dark);
        }

        [data-theme="light"] {
            --bg: var(--bg-light);
            --text: var(--text-light);
            --card: var(--card-light);
            --border: var(--border-light);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header Styles */
        .header {
            background: var(--card);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
            z-index: 100;
            transition: background-color 0.3s;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .title {
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Controls and Buttons */
        .controls {
            display: flex;
            gap: 12px;
        }

        .theme-toggle, .control-button {
            background: none;
            border: 2px solid var(--border);
            color: var(--text);
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        /* Search and Filters */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px 12px 40px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--card);
            color: var(--text);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text);
            opacity: 0.5;
        }

        /* Map Styles */
        #map {
            height: 400px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .location-info {
            background: var(--card);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Location Cards */
        .location-card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        /* Rest of your existing CSS */
         :root {
            --primary: #3b82f6;
            --primary-light: #60a5fa;
            --bg-light: #f8fafc;
            --text-light: #1e293b;
            --card-light: #ffffff;
            --border-light: #e2e8f0;
            --bg-dark: #0f172a;
            --text-dark: #e2e8f0;
            --card-dark: #1e293b;
            --border-dark: #334155;
        }

        [data-theme="dark"] {
            --bg: var(--bg-dark);
            --text: var(--text-dark);
            --card: var(--card-dark);
            --border: var(--border-dark);
        }

        [data-theme="light"] {
            --bg: var(--bg-light);
            --text: var(--text-light);
            --card: var(--card-light);
            --border: var(--border-light);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: var(--card);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
            z-index: 100;
            transition: background-color 0.3s;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .title {
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .controls {
            display: flex;
            gap: 12px;
        }

        .theme-toggle, .control-button {
            background: none;
            border: 2px solid var(--border);
            color: var(--text);
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .search-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            padding-left: 40px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--card);
            color: var(--text);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text);
            opacity: 0.5;
        }

        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--card);
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-btn:hover, .theme-toggle:hover, .control-button:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .location-card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .location-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .location-title-section {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .location-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .location-info h3 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .location-type {
            font-size: 14px;
            opacity: 0.7;
        }

        .location-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .facilities-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .facility-tag {
            background: var(--primary);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .route-visualization {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
            overflow-x: auto;
        }

        .route-map {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            min-width: max-content;
            padding: 20px 0;
            position: relative;
        }

        .route-point {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            margin: 0 40px;
        }

        .route-point:not(:last-child)::after {
            content: '';
            position: absolute;
            right: -40px;
            top: 25px;
            width: 40px;
            height: 2px;
            background: var(--primary);
        }

        .point-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            z-index: 1;
        }

        .point-label {
            font-size: 12px;
            text-align: center;
            max-width: 100px;
        }

        .expanded-content {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .expanded-content.active {
            display: block;
        }

        .expand-button {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 14px;
            padding: 5px 10px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: color 0.3s ease;
        }

        .expand-button:hover {
            color: var(--primary-light);
        }

        .no-results {
            text-align: center;
            padding: 20px;
            background: var(--card);
            border-radius: 12px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .header {
                position: static;
            }

            .header-top {
                flex-direction: column;
                gap: 16px;
            }

            .location-header {
                flex-direction: column;
                gap: 10px;
            }
        }

        .location-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin: 15px 0;
        }

        .attractions-list {
            list-style: none;
            margin: 10px 0;
            padding-left: 20px;
        }

        .attractions-list li {
            margin-bottom: 5px;
            position: relative;
        }

        .attractions-list li::before {
            content: "•";
            color: var(--primary);
            position: absolute;
            left: -15px;
        }

        .navigation-links {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            cursor: pointer;
            background: none;
            border: none;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .nav-link:hover {
            color: var(--primary-light);
        }
        /* ... (Include all the remaining CSS from the original file) */
    </style>
</head>
<body data-theme="light">
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-top">
                <h1 class="title">
                    <i class="fas fa-map-marked-alt"></i>
                    Narmada River Route
                </h1>
                <div class="controls">
                    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="control-button" id="helpButton" aria-label="Help">
                        <i class="fas fa-question-circle"></i>
                    </button>
                    <button class="control-button" id="locationButton" aria-label="Get location">
                        <i class="fas fa-location-arrow"></i>
                    </button>
                </div>
            </div>
            
            <!-- Search -->
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="searchInput" placeholder="Search locations, types, or facilities..." aria-label="Search">
            </div>

            <!-- Filters -->
            <div class="filters" role="toolbar" aria-label="Location filters">
                <button class="filter-btn active" data-filter="all">
                    <i class="fas fa-globe"></i>
                    All Locations
                </button>
                <button class="filter-btn" data-filter="temple">
                    <i class="fas fa-temple"></i>
                    Temples
                </button>
                <button class="filter-btn" data-filter="ann-kshetra">
                    <i class="fas fa-utensils"></i>
                    Ann Kshetra
                </button>
                <button class="filter-btn" data-filter="ashram">
                    <i class="fas fa-om"></i>
                    Ashrams
                </button>
                <button class="filter-btn" data-filter="ghat">
                    <i class="fas fa-water"></i>
                    Ghats
                </button>
                <button class="filter-btn" data-filter="village">
                    <i class="fas fa-house"></i>
                    Villages
                </button>
            </div>
        </header>

        <!-- Map Section -->
        <div id="map"></div>
        <div id="location-info" class="location-info"></div>

        <!-- Route Visualization -->
        <div class="route-visualization" id="routeVisualization">
            <h2>Route Overview</h2>
            <div class="route-map" id="routeMap"></div>
        </div>

        <!-- Locations List -->
        <main id="locationsList" role="main" aria-live="polite"></main>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script>
        // Data Structure
        const locations = [
    {
        id: 1,
        name: "Omkareshwar Temple",
        type: "temple",
        icon: "temple",
        distance: 0,
        coordinates: { lat: 22.2449, lng: 76.1492 },
        facilities: ["Parking", "Accommodation", "Prasad"],
        description: "One of the 12 Jyotirlinga temples, a sacred pilgrimage site situated on an island in the Narmada River.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 2,
        prevLocation: null,
        nearbyAttractions: ["Mamaleshwar Temple", "Narmada Ghat", "Sidhnath Temple"],
        contactInfo: "+91 XXXXXXXXXX"
    },
    {
        id: 2,
        name: "Shivkothi",
        type: "village",
        icon: "house",
        distance: 6,
        coordinates: { lat: 22.2248152, lng: 76.1164406 },
        facilities: ["Local Guides", "Basic Amenities", "Traditional Homestays"],
        description: "Historic village with rich religious significance and traditional architecture.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 3,
        prevLocation: 1,
        nearbyAttractions: ["Ancient Ruins", "Local Market", "Heritage Houses"],
        contactInfo: "Local Panchayat: +91 XXXXXXXXXX"
    },
    {
        id: 3,
        name: "Moratakka (Khedighat)",
        type: "ghat",
        icon: "water",
        distance: 6,
        coordinates: { lat: 22.2217718, lng: 76.0461051 }, 
        facilities: ["Boat Service", "Rest Area", "Meditation Spots"],
        description: "Important river crossing point with historical significance and spiritual importance.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 4,
        prevLocation: 2,
        nearbyAttractions: ["Ancient Stone Carvings", "Sunset Point", "River View"],
        contactInfo: "Ghat Manager: +91 XXXXXXXXXX"
    },

     {
        id: 4,
        name: "Tonksar (Gomukh Anna Kshetra)",
        type: "pilgrimage",
        icon: "temple",
        distance: 4,
        coordinates: { lat:  22.190989, lng: 75.971231},
        facilities: ["Free meals", "Shelter", "Meditation Hall"],
        description: "Place offering free food to pilgrims, with a serene environment for meditation.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 5,
        prevLocation: 3,
        nearbyAttractions: ["Sacred Banyan Tree", "Pilgrims Rest House", "Meditation Center"],
        contactInfo: "Temple Office: +91 XXXXXXXXXX"
    },
    {
        id: 5,
        name: "Pitnagar",
        type: "village",
        icon: "house",
        distance: 2,
        coordinates: { lat: 22.186755, lng: 75.957040 },
        facilities: ["Local Shops", "Food Stalls", "Crafts Market"],
        description: "Small village with local shops offering handmade crafts and traditional food.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 6,
        prevLocation: 4,
        nearbyAttractions: ["Local Market", "Traditional Houses", "Craft Workshops"],
        contactInfo: "Village Council: +91 XXXXXXXXXX"
    },
    {
        id: 6,
        name: "Kankaria",
        type: "village",
        icon: "house",
        distance: 4,
        coordinates: { lat: 22.188424, lng: 75.925668 }, 
        facilities: ["Restrooms", "Small Cafes", "Information Center"],
        description: "Village with basic facilities for travelers, known for its small cafes and local hospitality.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 7,
        prevLocation: 5,
        nearbyAttractions: ["Local Handicrafts", "Cultural Center", "Nature Walks"],
        contactInfo: "Village Head: +91 XXXXXXXXXX"
    },
    {
        id: 7,
        name: "Raverkhedi (Bajirao Samadhi)",
        type: "historical",
        icon: "memorial",
        distance: 6,
        coordinates: { lat:  22.173403, lng:  75.876766 },  
        facilities: ["Parking", "Guide Services", "Historical Tours"],
        description: "Historical site of Bajirao's memorial, offering guided tours and exhibits on local history.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 8,
        prevLocation: 6,
        nearbyAttractions: ["Museum", "Local History Exhibits", "Historical Ruins"],
        contactInfo: "Tourist Office: +91 XXXXXXXXXX"
    },
    {
        id: 8,
        name: "Bakawa Anna Kshetra",
        type: "pilgrimage",
        icon: "temple",
        distance: 4,
        coordinates: { lat:  22.169581, lng:75.848362 }, 
        facilities: ["Free meals", "Shelter", "Yoga Center"],
        description: "Anna Kshetra offering food to pilgrims, with a dedicated yoga center for visitors.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 9,
        prevLocation: 7,
        nearbyAttractions: ["Meditation Center", "Pilgrims Rest House", "Spiritual Library"],
        contactInfo: "Ashram Office: +91 XXXXXXXXXX"
    },
    {
        id: 9,
        name: "Mardana",
        type: "village",
        icon: "house",
        distance: 3,
        coordinates: { lat:  22.173926, lng:  75.819249 }, 
        facilities: ["Local Food", "Shops", "Guesthouses"],
        description: "Village with basic necessities, known for its traditional guesthouses and local cuisine.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 10,
        prevLocation: 8,
        nearbyAttractions: ["Local Handicrafts", "Traditional Houses", "Cultural Events"],
        contactInfo: "Village Council: +91 XXXXXXXXXX"
    },


    // Continuing to add more entries in the same format, based on the provided data
    // ...
];
        // Map Initialization
        // Location tracking and mapping enhancements
let userMarker = null;
let userCircle = null;
let map = null;

// Initialize map with user location tracking
function initMap() {
    const narmadaCenter = [22.7519, 77.7289];
    map = L.map('map').setView(narmadaCenter, 8);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Add markers for all locations
    locations.forEach(location => {
        const marker = L.marker([location.coordinates.lat, location.coordinates.lng])
            .bindPopup(`
                <b>${location.name}</b><br>
                Type: ${location.type}<br>
                Distance: <span id="distance-${location.id}">calculating...</span>
            `)
            .addTo(map);
    });

    // Start tracking user location
    startLocationTracking();
    
    return map;
}
// Calculate distance between two points using Haversine formula
function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Earth's radius in km
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
             Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
             Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

// Start continuous location tracking
function startLocationTracking() {
    if ("geolocation" in navigator) {
        // Watch position instead of getting it once
        const watchId = navigator.geolocation.watchPosition(
            position => updateUserLocation(position),
            error => handleLocationError(error),
            {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
            }
        );
    } else {
        alert('Geolocation is not supported by your browser.');
    }
}

        // Route Visualization
        function initializeRouteVisualization() {
            const routeMap = document.getElementById('routeMap');
            routeMap.innerHTML = locations.map(location => `
                <div class="route-point">
                    <div class="point-icon">
                        <i class="fas fa-${location.icon}"></i>
                    </div>
                    <span class="point-label">${location.name}</span>
                </div>
            `).join('');
        }

        // Search and Filter
        function initializeSearchAndFilter() {
            const searchInput = document.getElementById('searchInput');
            const filterButtons = document.querySelectorAll('.filter-btn');
            const locationsList = document.getElementById('locationsList');

            function updateLocations(searchTerm = '', filterType = 'all') {
                const filteredLocations = locations.filter(location => {
                    const matchesSearch = location.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                        location.type.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                        location.facilities.some(f => f.toLowerCase().includes(searchTerm.toLowerCase()));
                    
                    const matchesFilter = filterType === 'all' || location.type === filterType;
                    
                    return matchesSearch && matchesFilter;
                });

                locationsList.innerHTML = filteredLocations.length ? 
                    filteredLocations.map(location => createLocationCard(location, true)).join('') :
                    '<div class="no-results">No locations found matching your criteria</div>';
            }

            // Event Listeners
            searchInput.addEventListener('input', (e) => {
                const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
                updateLocations(e.target.value, activeFilter);
            });

            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    updateLocations(searchInput.value, button.dataset.filter);
                });
            });

            // Initial load
            updateLocations();
        }

        // Theme Toggle
        function initializeThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;
            const icon = themeToggle.querySelector('i');

            themeToggle.addEventListener('click', () => {
                const isDark = body.dataset.theme === 'dark';
                body.dataset.theme = isDark ? 'light' : 'dark';
                icon.className = isDark ? 'fas fa-moon' : 'fas fa-sun';
            });
        }

        // Utility Functions
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function scrollToLocation(locationId) {
            const element = document.getElementById(`location-${locationId}`);
            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }


        // Update user's location on map
function updateUserLocation(position) {
    const userLat = position.coords.latitude;
    const userLng = position.coords.longitude;
    
    // Remove existing user location markers
    if (userMarker) map.removeLayer(userMarker);
    if (userCircle) map.removeLayer(userCircle);
    
    // Add user location marker
    const userIcon = L.divIcon({
        html: '<i class="fas fa-user-circle" style="color: #2563eb; font-size: 24px;"></i>',
        className: 'user-location-marker',
        iconSize: [24, 24]
    });
    
    userMarker = L.marker([userLat, userLng], {icon: userIcon})
        .bindPopup('Your location')
        .addTo(map);
    
    // Add accuracy circle
    userCircle = L.circle([userLat, userLng], {
        radius: position.coords.accuracy,
        color: '#2563eb',
        fillColor: '#60a5fa',
        fillOpacity: 0.2
    }).addTo(map);
    
    // Update distances to all locations
    updateDistances(userLat, userLng);
    
    // Find and highlight nearest location
    const nearest = findNearestLocation(userLat, userLng);
    updateNearestLocationInfo(nearest);
}

// Update distances to all locations
function updateDistances(userLat, userLng) {
    locations.forEach(location => {
        const distance = calculateDistance(
            userLat, userLng,
            location.coordinates.lat,
            location.coordinates.lng
        );
        
        // Update distance in popup
        const distanceElement = document.getElementById(`distance-${location.id}`);
        if (distanceElement) {
            distanceElement.textContent = `${distance.toFixed(1)} km`;
        }
    });
}

// Find nearest location
function findNearestLocation(userLat, userLng) {
    return locations.reduce((nearest, location) => {
        const distance = calculateDistance(
            userLat, userLng,
            location.coordinates.lat,
            location.coordinates.lng
        );
        return distance < nearest.distance ? { location, distance } : nearest;
    }, { location: null, distance: Infinity });
}

// Update nearest location information
function updateNearestLocationInfo(nearest) {
    const locationInfo = document.getElementById('location-info');
    if (nearest.location) {
        locationInfo.innerHTML = `
            <h3>Nearest Location</h3>
            <p><strong>${nearest.location.name}</strong></p>
            <p>Distance: ${nearest.distance.toFixed(1)} km</p>
            <p>Type: ${nearest.location.type}</p>
            <button onclick="scrollToLocation(${nearest.location.id})" class="filter-btn">
                <i class="fas fa-map-marker-alt"></i> View Details
            </button>
        `;
    }
}

// Handle location errors
function handleLocationError(error) {
    let message = 'Unable to retrieve your location. ';
    switch(error.code) {
        case error.PERMISSION_DENIED:
            message += 'Please enable location services to use this feature.';
            break;
        case error.POSITION_UNAVAILABLE:
            message += 'Location information is unavailable.';
            break;
        case error.TIMEOUT:
            message += 'The request to get location timed out.';
            break;
        case error.UNKNOWN_ERROR:
            message += 'An unknown error occurred.';
            break;
    }
    alert(message);
}

// Location button click handler
function handleLocationButtonClick() {
    if (userMarker) {
        map.setView(userMarker.getLatLng(), 12);
    } else {
        startLocationTracking();
    }
}

// Update the initialization
document.addEventListener('DOMContentLoaded', () => {
    const map = initMap();
    initializeRouteVisualization();
    initializeSearchAndFilter();
    initializeThemeToggle();

    // Update location button handler
    document.getElementById('locationButton').addEventListener('click', handleLocationButtonClick);
});

        // Initialize Application
        document.addEventListener('DOMContentLoaded', () => {
            const map = initMap();
            initializeRouteVisualization();
            initializeSearchAndFilter();
            initializeThemeToggle();

            // Help Button Handler
            document.getElementById('helpButton').addEventListener('click', () => {
                alert(`Welcome to the Narmada River Route Guide!

Navigation Tips:
- Use filters above to explore different types of locations
- Search box helps find specific places or facilities
- Click "Show More" to see additional details about each location
- Use the theme toggle for light/dark mode
- Previous/Next buttons help navigate between connected locations

For the best experience, enable location services to find nearby points of interest.`);
            });

            // Location Button Handler
            document.getElementById('locationButton').addEventListener('click', () => {
                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            const userLat = position.coords.latitude;
                            const userLng = position.coords.longitude;
                            
                            // Find nearest location
                            const nearest = locations.reduce((nearest, location) => {
                                const distance = calculateDistance(
                                    userLat, userLng,
                                    location.coordinates.lat,
                                    location.coordinates.lng
                                );
                                return distance < nearest.distance ? { location, distance } : nearest;
                            }, { location: null, distance: Infinity });

                            if (nearest.location) {
                                alert(`Nearest location: ${nearest.location.name}\nApprox. distance: ${nearest.distance.toFixed(1)} km`);
                                scrollToLocation(nearest.location.id);
                            }
                        },
                        error => {
                            let message = 'Unable to retrieve your location. ';
                            switch(error.code) {
                                case error.PERMISSION_DENIED:
                                    message += 'Please enable location services to use this feature.'
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    message += 'Location information is unavailable.';
                                    break;
                                case error.TIMEOUT:
                                    message += 'The request to get location timed out.';
                                    break;
                                case error.UNKNOWN_ERROR:
                                    message += 'An unknown error occurred.';
                                    break;
                            }
                            alert(message);
                        }
                    );
                } else {
                    alert('Geolocation is not supported by your browser.');
                }
            });
        });

        // Location Card Creation (Complete Implementation)
        function createLocationCard(location, showNavigation = false) {
            return `
                <article class="location-card" id="location-${location.id}">
                    <div class="location-header">
                        <h2 class="location-title">
                            <i class="fas fa-${location.icon}"></i>
                            ${location.name}
                        </h2>
                        <span class="location-type">${location.type}</span>
                    </div>

                    <div class="location-image">
                        <img src="${location.imageUrl}" alt="${location.name}" loading="lazy">
                    </div>

                    <div class="location-details">
                        <p class="location-description">${location.description}</p>
                        
                        <div class="location-facilities">
                            <h3>Available Facilities:</h3>
                            <ul>
                                ${location.facilities.map(facility => `
                                    <li><i class="fas fa-check"></i> ${facility}</li>
                                `).join('')}
                            </ul>
                        </div>

                        <div class="location-coordinates">
                            <p>
                                <i class="fas fa-map-marker-alt"></i>
                                Coordinates: ${location.coordinates.lat}, ${location.coordinates.lng}
                            </p>
                        </div>

                        ${location.nearbyAttractions.length ? `
                            <div class="nearby-attractions">
                                <h3>Nearby Attractions:</h3>
                                <ul>
                                    ${location.nearbyAttractions.map(attraction => `
                                        <li><i class="fas fa-landmark"></i> ${attraction}</li>
                                    `).join('')}
                                </ul>
                            </div>
                        ` : ''}

                        <div class="contact-info">
                            <p>
                                <i class="fas fa-phone"></i>
                                Contact: ${location.contactInfo}
                            </p>
                        </div>
                    </div>

                    ${showNavigation ? `
                        <div class="location-navigation">
                            ${location.prevLocation ? `
                                <button class="nav-btn prev" onclick="scrollToLocation(${location.prevLocation})">
                                    <i class="fas fa-arrow-left"></i> Previous Location
                                </button>
                            ` : ''}
                            ${location.nextLocation ? `
                                <button class="nav-btn next" onclick="scrollToLocation(${location.nextLocation})">
                                    Next Location <i class="fas fa-arrow-right"></i>
                                </button>
                            ` : ''}
                        </div>
                    ` : ''}
                </article>
            `;
        }

        // Add additional CSS for new components
        document.head.insertAdjacentHTML('beforeend', `
            <style>
                .location-card {
                    transition: transform 0.3s ease;
                }

                .location-card:hover {
                    transform: translateY(-4px);
                }

                .location-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 1rem;
                }

                .location-title {
                    font-size: 1.5rem;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                }

                .location-type {
                    background: var(--primary);
                    color: white;
                    padding: 0.25rem 0.75rem;
                    border-radius: 1rem;
                    font-size: 0.875rem;
                }

                .location-image {
                    width: 100%;
                    height: 200px;
                    overflow: hidden;
                    border-radius: 8px;
                    margin-bottom: 1rem;
                }

                .location-image img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }

                .location-facilities ul,
                .nearby-attractions ul {
                    list-style: none;
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 0.5rem;
                    margin: 0.5rem 0;
                }

                .nav-btn {
                    background: var(--primary);
                    color: white;
                    border: none;
                    padding: 0.5rem 1rem;
                    border-radius: 4px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    transition: background-color 0.3s;
                }

                .nav-btn:hover {
                    background: var(--primary-light);
                }

                .location-navigation {
                    display: flex;
                    justify-content: space-between;
                    margin-top: 1rem;
                    padding-top: 1rem;
                    border-top: 1px solid var(--border);
                }

                @media (max-width: 768px) {
                    .location-facilities ul,
                    .nearby-attractions ul {
                        grid-template-columns: 1fr;
                    }

                    .location-navigation {
                        flex-direction: column;
                        gap: 0.5rem;
                    }

                    .nav-btn {
                        width: 100%;
                        justify-content: center;
                    }
                }
            </style>
        `);


// Add these styles to the existing styles section
const newStyles = `
.route-point {
    transition: transform 0.3s ease, opacity 0.3s ease;
}

.route-point.nearest {
    transform: scale(1.1);
    position: relative;
}

.route-point.nearest::before {
    content: '📍 You are near here';
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--primary);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    animation: bounce 1s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(-5px); }
}

.route-point:not(.nearest) {
    opacity: 0.7;
}`;

// Add the styles to the document
document.head.insertAdjacentHTML('beforeend', `<style>${newStyles}</style>`);

// Update the updateNearestLocationInfo function
function updateNearestLocationInfo(nearest) {
    const locationInfo = document.getElementById('location-info');
    if (nearest.location) {
        // Update location info card
        locationInfo.innerHTML = `
            <h3>Nearest Location</h3>
            <p><strong>${nearest.location.name}</strong></p>
            <p>Distance: ${nearest.distance.toFixed(1)} km</p>
            <p>Type: ${nearest.location.type}</p>
            <button onclick="scrollToLocation(${nearest.location.id})" class="filter-btn">
                <i class="fas fa-map-marker-alt"></i> View Details
            </button>
        `;

        // Update route visualization
        const routePoints = document.querySelectorAll('.route-point');
        routePoints.forEach(point => {
            point.classList.remove('nearest');
            if (point.querySelector('.point-label').textContent === nearest.location.name) {
                point.classList.add('nearest');
            }
        });
    }
}

// Update the initializeRouteVisualization function
function initializeRouteVisualization() {
    const routeMap = document.getElementById('routeMap');
    routeMap.innerHTML = locations.map(location => `
        <div class="route-point" id="route-point-${location.id}">
            <div class="point-icon">
                <i class="fas fa-${location.icon}"></i>
            </div>
            <span class="point-label">${location.name}</span>
        </div>
    `).join('');
}
    </script>
</body>
</html>
