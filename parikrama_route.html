<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narmada River Explorer Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2e5090;
            --secondary-color: #4CAF50;
            --accent-color: #FFC107;
            --text-color: #333;
            --background-color: #f5f5f5;
            --danger-color: #dc3545;
        }

        body, html { 
            margin: 0; 
            padding: 0; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background-color);
            color: var(--text-color);
        }

        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), #1a365d);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .title {
            font-size: 2.5em;
            margin: 0;
            padding: 10px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin: 10px 0;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .controls-left, .controls-right {
            display: flex;
            gap: 15px;
        }

        .view-button {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background: white;
            color: var(--primary-color);
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .view-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .view-button.active {
            background: var(--primary-color);
            color: white;
        }

        .weather-display {
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .weather-details {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .weather-metric {
            font-size: 0.9em;
            color: #666;
        }

        .map-container {
            height: 600px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
            position: relative;
        }

        .map-container.active {
            display: block;
        }

        .locations-grid {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .locations-grid.active {
            display: grid;
        }

        .location-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .location-item:hover {
            transform: translateY(-5px);
        }

        .location-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-visited {
            background: var(--secondary-color);
            color: white;
        }

        .status-next {
            background: var(--accent-color);
            color: black;
        }

        .status-locked {
            background: #666;
            color: white;
        }

        .location-details {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }

        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .gallery-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .gallery-image:hover {
            transform: scale(1.05);
        }

        .progress-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            height: 20px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--secondary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(46, 80, 144, 0.1);
            border-radius: 8px;
        }

        .custom-marker-container {
            background: none;
            border: none;
        }

        .custom-marker {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .achievement {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-color);
            color: black;
            padding: 15px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { transform: translate(-50%, 100%); }
            to { transform: translate(-50%, 0); }
        }

        .offline-warning {
            background: var(--danger-color);
            color: white;
            padding: 10px;
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    <div class="offline-warning" id="offlineWarning">
        You are currently offline. Some features may be limited.
    </div>
    <div class="container">
        <header class="header animate__animated animate__fadeIn">
            <h1 class="title">üèõÔ∏è Narmada River Explorer Pro</h1>
            <p class="subtitle">Discover the sacred sites along India's holiest river</p>
            
            <div class="controls">
                <div class="controls-left">
                    <button onclick="toggleView('map')" class="view-button active" id="mapViewBtn">
                        <i class="fas fa-map-marked-alt"></i> Map View
                    </button>
                    <button onclick="toggleView('list')" class="view-button" id="listViewBtn">
                        <i class="fas fa-list"></i> List View
                    </button>
                    <button onclick="locateUser()" class="view-button">
                        <i class="fas fa-location-arrow"></i> Find Me
                    </button>
                </div>
                <div class="weather-display">
                    <i class="fas fa-sun" style="color: #FFC107; font-size: 24px;"></i>
                    <div class="weather-details">
                        <div id="currentTemp">Loading...</div>
                        <div class="weather-metric" id="humidity"></div>
                        <div class="weather-metric" id="windSpeed"></div>
                    </div>
                </div>
            </div>
        </header>

        <div class="progress-container">
            <h3>Journey Progress</h3>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <i class="fas fa-check-circle"></i>
                    <h4>Sites Visited</h4>
                    <p id="visitedCount">0/0</p>
                </div>
                <div class="stat-item">
                    <i class="fas fa-road"></i>
                    <h4>Distance Covered</h4>
                    <p id="distanceCovered">0 km</p>
                </div>
                <div class="stat-item">
                    <i class="fas fa-clock"></i>
                    <h4>Journey Time</h4>
                    <p id="journeyTime">0h 0m</p>
                </div>
                <div class="stat-item">
                    <i class="fas fa-history"></i>
                    <h4>Last Visit</h4>
                    <p id="lastVisit">None</p>
                </div>
            </div>
        </div>

        <main>
            <div id="map" class="map-container active"></div>
            <div id="locationsList" class="locations-grid"></div>
        </main>

        <div id="modalOverlay" class="modal-overlay"></div>
        <div id="locationDetails" class="location-details"></div>
        <div id="notification" class="notification"></div>
        <div id="achievement" class="achievement"></div>
    </div>

    <script>
        // Data structure for locations
       const locations = [
    {
        id: 1,
        name: "Omkareshwar Temple",
        type: "temple",
        icon: "temple",
        distance: 0,
        coordinates: { lat: 22.2449, lng: 76.1492 },
        facilities: ["Parking", "Accommodation", "Prasad"],
        description: "One of the 12 Jyotirlinga temples, a sacred pilgrimage site situated on an island in the Narmada River.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 2,
        prevLocation: null,
        nearbyAttractions: ["Mamaleshwar Temple", "Narmada Ghat", "Sidhnath Temple"],
        contactInfo: "+91 XXXXXXXXXX"
    },
    {
        id: 2,
        name: "Shivkothi",
        type: "village",
        icon: "house",
        distance: 6,
        coordinates: { lat: 22.2248152, lng: 76.1164406 },
        facilities: ["Local Guides", "Basic Amenities", "Traditional Homestays"],
        description: "Historic village with rich religious significance and traditional architecture.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 3,
        prevLocation: 1,
        nearbyAttractions: ["Ancient Ruins", "Local Market", "Heritage Houses"],
        contactInfo: "Local Panchayat: +91 XXXXXXXXXX"
    },
    {
        id: 3,
        name: "Moratakka (Khedighat)",
        type: "ghat",
        icon: "water",
        distance: 6,
        coordinates: { lat: 22.2217718, lng: 76.0461051 }, 
        facilities: ["Boat Service", "Rest Area", "Meditation Spots"],
        description: "Important river crossing point with historical significance and spiritual importance.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 4,
        prevLocation: 2,
        nearbyAttractions: ["Ancient Stone Carvings", "Sunset Point", "River View"],
        contactInfo: "Ghat Manager: +91 XXXXXXXXXX"
    },
    {
        id: 4,
        name: "Tonksar (Gomukh Anna Kshetra)",
        type: "pilgrimage",
        icon: "temple",
        distance: 4,
        coordinates: { lat: 22.190989, lng: 75.971231 },
        facilities: ["Free meals", "Shelter", "Meditation Hall"],
        description: "Place offering free food to pilgrims, with a serene environment for meditation.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 5,
        prevLocation: 3,
        nearbyAttractions: ["Sacred Banyan Tree", "Pilgrims Rest House", "Meditation Center"],
        contactInfo: "Temple Office: +91 XXXXXXXXXX"
    },
    {
        id: 5,
        name: "Pitnagar",
        type: "village",
        icon: "house",
        distance: 2,
        coordinates: { lat: 22.186755, lng: 75.957040 },
        facilities: ["Local Shops", "Food Stalls", "Crafts Market"],
        description: "Small village with local shops offering handmade crafts and traditional food.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 6,
        prevLocation: 4,
        nearbyAttractions: ["Local Market", "Traditional Houses", "Craft Workshops"],
        contactInfo: "Village Council: +91 XXXXXXXXXX"
    },
    {
        id: 6,
        name: "Kankaria",
        type: "village",
        icon: "house",
        distance: 4,
        coordinates: { lat: 22.188424, lng: 75.925668 },
        facilities: ["Restrooms", "Small Cafes", "Information Center"],
        description: "Village with basic facilities for travelers, known for its small cafes and local hospitality.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 7,
        prevLocation: 5,
        nearbyAttractions: ["Local Handicrafts", "Cultural Center", "Nature Walks"],
        contactInfo: "Village Head: +91 XXXXXXXXXX"
    },
    {
        id: 7,
        name: "Raverkhedi (Bajirao Samadhi)",
        type: "historical",
        icon: "memorial",
        distance: 6,
        coordinates: { lat: 22.173403, lng: 75.876766 },
        facilities: ["Parking", "Guide Services", "Historical Tours"],
        description: "Historical site of Bajirao's memorial, offering guided tours and exhibits on local history.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 8,
        prevLocation: 6,
        nearbyAttractions: ["Museum", "Local History Exhibits", "Historical Ruins"],
        contactInfo: "Tourist Office: +91 XXXXXXXXXX"
    },
    {
        id: 8,
        name: "Bakawa Anna Kshetra",
        type: "pilgrimage",
        icon: "temple",
        distance: 4,
        coordinates: { lat: 22.169581, lng: 75.848362 },
        facilities: ["Free meals", "Shelter", "Yoga Center"],
        description: "Anna Kshetra offering food to pilgrims, with a dedicated yoga center for visitors.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: 9,
        prevLocation: 7,
        nearbyAttractions: ["Meditation Center", "Pilgrims Rest House", "Spiritual Library"],
        contactInfo: "Ashram Office: +91 XXXXXXXXXX"
    },
    {
        id: 9,
        name: "Mardana",
        type: "village",
        icon: "house",
        distance: 3,
        coordinates: { lat: 22.173926, lng: 75.819249 },
        facilities: ["Local Food", "Shops", "Guesthouses"],
        description: "Village with basic necessities, known for its traditional guesthouses and local cuisine.",
        imageUrl: "/api/placeholder/800/400",
        nextLocation: null,
        prevLocation: 8,
        nearbyAttractions: ["Local Handicrafts", "Traditional Houses", "Cultural Events"],
        contactInfo: "Village Council: +91 XXXXXXXXXX"
    }
];



        let map;
        let currentLocationIndex = 0;
        let journeyStartTime = null;

        // Initialize the application
        function initializeApp() {
            initializeMap();
            updateProgress();
            updateWeatherDisplay();
            startJourneyTimer();
            renderLocationsList();
            checkOnlineStatus();
            loadSavedData();
            updateDistanceCovered();
updateJourneyTime();
updateLastVisit();

        }

        function startJourneyTimer() {
    if (!journeyStartTime && currentLocationIndex === 0) {
        journeyStartTime = new Date();
        saveData(); // Save the journey start time
    }
}

function updateJourneyTime() {
    if (journeyStartTime) {
        const currentTime = new Date();
        const elapsedTime = currentTime - journeyStartTime; // Time in milliseconds

        // Convert elapsed time to hours and minutes
        const hours = Math.floor(elapsedTime / (1000 * 60 * 60));
        const minutes = Math.floor((elapsedTime % (1000 * 60 * 60)) / (1000 * 60));

        document.getElementById('journeyTime').textContent = `${hours}h ${minutes}m`;
    }
}



function updateWeatherDisplay() {
    const weatherDisplay = document.querySelector('.weather-display');
    const currentTemp = document.getElementById('currentTemp');
    const humidity = document.getElementById('humidity');
    const windSpeed = document.getElementById('windSpeed');

    if (locations.length > 0) {
        const weather = locations[currentLocationIndex].weather;
        currentTemp.textContent = `Temperature: ${weather.temp}¬∞C`;
        humidity.textContent = `Humidity: ${weather.humidity}%`;
        windSpeed.textContent = `Wind Speed: ${weather.windSpeed} km/h`;
    } else {
        weatherDisplay.style.display = 'none';
    }
}

        // Check online status
        function checkOnlineStatus() {
            function updateOnlineStatus() {
                const offlineWarning = document.getElementById('offlineWarning');
                if (navigator.onLine) {
                    offlineWarning.style.display = 'none';
                } else {
                    offlineWarning.style.display = 'block';
                }
            }

            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            updateOnlineStatus();
        }

        // Initialize Leaflet map
        function initializeMap() {
            if (map) {
                map.remove();
            }

            map = L.map('map').setView([22.2394, 76.1514], 9);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            locations.forEach((location, index) => {
                addLocationMarker(location, index);
            });
        }

        // Toggle between map and list views
        function toggleView(view) {
    const mapContainer = document.getElementById('map');
    const listContainer = document.getElementById('locationsList');
    const mapButton = document.getElementById('mapViewBtn');
    const listButton = document.getElementById('listViewBtn');

    if (view === 'map') {
        mapContainer.classList.add('active');
        listContainer.classList.remove('active');
        mapButton.classList.add('active');
        listButton.classList.remove('active');

        // Check if the map instance is already created
        if (!map) {
            initializeMap();
        } else {
            map.invalidateSize(); // Redraw map if container size changed
        }
    } else {
        mapContainer.classList.remove('active');
        listContainer.classList.add('active');
        mapButton.classList.remove('active');
        listButton.classList.add('active');
        renderLocationsList();
    }
}


        // Render locations list view
        function renderLocationsList() {
            const container = document.getElementById('locationsList');
            container.innerHTML = locations.map((location, index) => `
                <div class="location-item" onclick="showLocationDetails(${location.id})">
                    <div class="location-status ${getLocationStatus(index)}">
                        ${getLocationStatusText(index)}
                    </div>
                    <img src="${location.image}" alt="${location.name}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 10px;">
                    <h3>${location.name}</h3>
                    <p>${location.description}</p>
                    <div class="location-meta">
                        <span><i class="fas fa-map-marker-alt"></i> ${location.distance}km</span>
                        ${location.visited ? `
                            <span><i class="fas fa-clock"></i> ${formatVisitTime(location.visitedTime)}</span>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Get location status class
        function getLocationStatus(index) {
            if (locations[index].visited) return 'status-visited';
            if (index === currentLocationIndex) return 'status-next';
            return 'status-locked';
        }

        // Get location status text
        function getLocationStatusText(index) {
            if (locations[index].visited) return 'Visited';
            if (index === currentLocationIndex) return 'Next Stop';
            return 'Locked';
        }

        // Format visit time
        function formatVisitTime(time) {
            if (!time) return '';
            return new Date(time).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Add marker for a location
        function addLocationMarker(location, index) {
    const icon = L.divIcon({
        className: 'custom-marker-container',
        html: `<div class="custom-marker" style="background-color: ${getMarkerColor(index)}">
                ${location.visited ? '‚úì' : (index + 1)}
              </div>`,
        iconSize: [30, 30]
    });

    const marker = L.marker(location.coordinates, { icon });
    marker.bindPopup(createPopupContent(location)).on('click', () => {
        showLocationDetails(location.id);
    });
    marker.addTo(map);

    // Add paths if previous location was visited
    if (index > 0 && locations[index - 1].visited) {
        drawPathLine(locations[index - 1].coordinates, location.coordinates);
    }
}


        // Get marker color based on status
        function getMarkerColor(index) {
            if (locations[index].visited) return '#4CAF50';
            if (index === currentLocationIndex) return '#2196F3';
            return '#FF5722';
        }

        // Create popup content
        function createPopupContent(location) {
            return `
                <div class="popup-content">
                    <h3>${location.name}</h3>
                    <p>${location.description}</p>
                    <button onclick="showLocationDetails(${location.id})" class="view-button">
                        View Details
                    </button>
                </div>
            `;
        }

        // Draw path line between locations
        function drawPathLine(start, end) {
            L.polyline([start, end], {
                color: '#2e5090',
                weight: 3,
                opacity: 0.6,
                dashArray: '10, 10'
            }).addTo(map);
        }

        // Show location details modal
        function showLocationDetails(locationId) {
            const location = locations.find(loc => loc.id === locationId);
            const modal = document.getElementById('locationDetails');
            const overlay = document.getElementById('modalOverlay');
            
            modal.innerHTML = createLocationDetailsContent(location);
            modal.style.display = 'block';
            overlay.style.display = 'block';
            
            // Enable closing modal by clicking overlay
            overlay.onclick = closeLocationDetails;
        }

        // Close location details modal
        function closeLocationDetails() {
            document.getElementById('locationDetails').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
        }

        // Mark location as visited
        function markAsVisited(locationId) {
    const location = locations.find(loc => loc.id === locationId);
    
    // Ensure the current location is the one to be marked as visited
    if (locations.indexOf(location) === currentLocationIndex) {
        location.visited = true;
        location.visitedTime = new Date();
        currentLocationIndex++;

        // Update distance covered, journey time, and last visit
        updateDistanceCovered();
        updateJourneyTime();
        updateLastVisit();

        updateProgress();
        saveData();
        initializeMap();
        showNotification(`üéâ You've visited ${location.name}!`);
        checkAchievements();
        closeLocationDetails();
    } else {
        showNotification('You must visit locations in order', 3000);
    }
}

function updateLastVisit() {
    const lastVisitedLocation = locations
        .filter(loc => loc.visited)
        .sort((a, b) => new Date(b.visitedTime) - new Date(a.visitedTime))[0];

    if (lastVisitedLocation && lastVisitedLocation.visitedTime) {
        const lastVisitTime = new Date(lastVisitedLocation.visitedTime);
        document.getElementById('lastVisit').textContent = lastVisitTime.toLocaleString('en-US', {
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    } else {
        document.getElementById('lastVisit').textContent = 'None';
    }
}



function updateDistanceCovered() {
    const distanceCovered = locations
        .filter(loc => loc.visited)
        .reduce((total, loc) => total + loc.distance, 0);

    document.getElementById('distanceCovered').textContent = `${distanceCovered} km`;
}



        function createLocationDetailsContent(location) {
    return `
        <button class="close-button" onclick="closeLocationDetails()">&times;</button>
        <h2>${location.name}</h2>
        <p>${location.description}</p>
        <div class="photo-gallery">
            ${location.gallery.map(image => `<img src="${image}" alt="Gallery image" class="gallery-image">`).join('')}
        </div>
        <div class="location-facts">
            <h3>Interesting Facts</h3>
            <ul>
                ${location.facts.map(fact => `<li>${fact}</li>`).join('')}
            </ul>
        </div>
        <div class="location-actions">
            <textarea placeholder="Notes..." onblur="saveNotes(${location.id}, this.value)">${location.notes || ''}</textarea>
            ${location.visited ? `
                <button onclick="undoVisit(${location.id})" class="view-button" style="background-color: var(--danger-color); color: white;">
                    Undo Visit
                </button>
            ` : `
                <button onclick="markAsVisited(${location.id})" class="view-button" style="background-color: var(--secondary-color); color: white;">
                    Mark as Visited
                </button>
            `}
        </div>
    `;
}



        // Undo visit to location
        function undoVisit(locationId) {
    const locationIndex = locations.findIndex(loc => loc.id === locationId);
    const location = locations[locationIndex];

    // Check if the location is visited and if it's the most recent one
    if (location.visited && locationIndex === currentLocationIndex - 1) {
        location.visited = false;
        location.visitedTime = null;
        currentLocationIndex--;

        updateProgress();
        saveData();
        initializeMap();
        showNotification(`Visit to ${location.name} has been undone`);
        closeLocationDetails();
    } else {
        showNotification('Cannot undo visit: You must undo the most recent visit first', 3000);
    }
}


        // Save notes for a location
        function saveNotes(locationId, notes) {
            const location = locations.find(loc => loc.id === locationId);
            if (location) {
                location.notes = notes;
                saveData();
                showNotification('Notes saved successfully');
            }
        }

        // Show notification
        function showNotification(message, duration = 3000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, duration);
        }

        // Show achievement
        function showAchievement(message) {
            const achievement = document.getElementById('achievement');
            achievement.textContent = `üèÜ ${message}`;
            achievement.style.display = 'block';
            
            setTimeout(() => {
                achievement.style.display = 'none';
            }, 5000);
        }

        // Check for achievements
        function checkAchievements() {
            const visitedCount = locations.filter(loc => loc.visited).length;
            const totalLocations = locations.length;
            
            if (visitedCount === 1) {
                showAchievement('First Steps: Visit your first location!');
            } else if (visitedCount === Math.floor(totalLocations / 2)) {
                showAchievement('Halfway There: Visit half of all locations!');
            } else if (visitedCount === totalLocations) {
                showAchievement('Journey Complete: Visit all locations!');
            }
        }

        // Find user's location
        function locateUser() {
    if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(
            position => {
                const userLocation = [position.coords.latitude, position.coords.longitude];
                map.setView(userLocation, 11);

                const userMarker = L.marker(userLocation, {
                    icon: L.divIcon({
                        className: 'custom-marker-container',
                        html: '<div class="custom-marker" style="background-color: #9C27B0"><i class="fas fa-user"></i></div>'
                    })
                }).addTo(map);

                userMarker.bindPopup('You are here').openPopup();
            },
            error => {
                showNotification('Unable to access your location: ' + error.message, 3000);
            }
        );
    } else {
        showNotification('Geolocation is not supported by your browser', 3000);
    }
}


        // Save data to localStorage
        function saveData() {
    const data = {
        locations: locations,
        currentLocationIndex: currentLocationIndex,
        journeyStartTime: journeyStartTime
    };
    localStorage.setItem('narmadaExplorerData', JSON.stringify(data));
}


        // Load saved data from localStorage
        function loadSavedData() {
    const savedData = localStorage.getItem('narmadaExplorerData');
    if (savedData) {
        try {
            const data = JSON.parse(savedData);
            locations.forEach((location, index) => {
                if (data.locations && data.locations[index]) {
                    Object.assign(location, data.locations[index]);
                }
            });
            currentLocationIndex = data.currentLocationIndex || 0;
            journeyStartTime = data.journeyStartTime ? new Date(data.journeyStartTime) : null;

            updateProgress();
            if (map) initializeMap();
        } catch (error) {
            console.error('Error loading data:', error);
        }
    }
}

function updateProgress() {
    const visitedCount = locations.filter(loc => loc.visited).length;
    const totalLocations = locations.length;

    // Update visited count and progress bar
    document.getElementById('visitedCount').textContent = `${visitedCount}/${totalLocations}`;
    const progressFill = document.getElementById('progressFill');
    progressFill.style.width = `${(visitedCount / totalLocations) * 100}%`;
}


        // Initialize the application when the page loads
        window.onload = initializeApp;
    </script>
</body>
</html>